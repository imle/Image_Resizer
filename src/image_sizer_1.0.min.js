$.widget("custom.cropper",{version:"1.0",widget_event_prefix:"cropping",options:{width:400,height:400,zoom:2,contain:false,image_url:"https://stevenimle.github.io/Image_Resizer/examples/images/example_image_1.jpg",button:null,submit:function(){},slide:function(){},drag:function(){}},limits:{min:{height:100,width:100,zoom:2},max:{height:500,width:700,zoom:4}},_create:function(){this.element.hide();this._createElements();this._setValueLimits();this._getElements();this._setImage()},_setup:function(b){b.$outer_container.height(b.options.height);b.$outer_container.width(b.options.width);b.original_height=parseInt(b.$foreground_image.height());b.original_width=parseInt(b.$foreground_image.width());var a={height:b.$main_container.outerHeight(),width:b.original_width*(b.$main_container.outerHeight()/b.original_height)};b.$foreground_image.css(a);b.$background_image.css(a);b.initial_height=parseInt(b.$foreground_image.height());b.initial_width=parseInt(b.$foreground_image.width());a={left:-(b.initial_width/2-b.options.width/2),top:-(parseInt(b.$main_container.css("padding-top")))};b.$foreground_image.css(a);b.$drag_helper.css(a);b.$resize_container.css({height:b.initial_height*2-b.options.height,width:b.initial_width*2-b.options.width,left:b.options.width-b.initial_width,top:b.options.height-b.initial_height});b.resize_center={x:(b.options.width/2-parseInt(b.$foreground_image.css("left")))/b.initial_width,y:(b.options.height/2-parseInt(b.$foreground_image.css("top")))/b.initial_height};b.minimum=b.options.contain?Math.min(b.options.height/b.initial_height,b.options.width/b.initial_width):Math.max(b.options.height/b.initial_height,b.options.width/b.initial_width);b._createEventListeners(b)},_setImage:function(){var a=this;this.$foreground_image.attr("src",this.options.image_url);this.$background_image.attr("src",this.options.image_url).load(function(){a.element.show();a._setup(a)})},_getElements:function(){this.$foreground_image=this.element.find("#foreground_crop_image");this.$background_image=this.element.find("#background_crop_image");this.$outer_container=this.element.find("#cropping_gredyed_container");this.$main_container=this.element.find("#cropping_main_container");this.$drag_helper=this.element.find("#cropping_drag_helper");this.$resize_container=this.element.find("#cropping_sizing_container");this.$resize_warning=this.element.find("#cropping_resize_warning")},_setValueLimits:function(){this.options.height=this.options.height<this.limits.min.height?this.limits.min.height:this.options.height>this.limits.max.height?this.limits.max.height:this.options.height;this.options.width=this.options.width<this.limits.min.width?this.limits.min.width:this.options.width>this.limits.max.width?this.limits.max.width:this.options.width;this.options.zoom=this.options.zoom<this.limits.min.zoom?this.limits.min.zoom:this.options.zoom>this.limits.max.zoom?this.limits.max.zoom:this.options.zoom},_createElements:function(){this.element.html('<div id="cropping_main_container"><div id="cropping_gredyed_container"><div id="cropping_sizing_container"></div><div id="cropping_inner_container"><img id="foreground_crop_image" src=""/></div><div id="cropping_drag_helper"><img id="background_crop_image" src=""/><div id="cropping_pointer"></div></div><div id="cropping_dtr"><span>Drag to Reposition</span></div></div><div id="cropping_slider_outer_container"><div id="cropping_slider_container"><div class="cropping_slider_indicator" id="csi_minus"></div><div id="cropping_slider"></div><div class="cropping_slider_indicator" id="csi_plus"></div></div></div><div id="cropping_resize_warning"><span>Zooming in this close will make your photo less clear.</span></div></div><div id="cropping_footer"><div id="save_button"><span>Save</span></div></div>')},_createEventListeners:function(a){if(!this.options.button){this.options.button=this.element.find("#save_button");this.element.find("#cropping_footer").show()}this.options.button.click(function(){var b={left:Math.abs(parseInt(a.$foreground_image.css("left"))),top:Math.abs(parseInt(a.$foreground_image.css("top")))};a.options.submit({height:a.options.height,width:a.options.width,ratio:a.$foreground_image.height()/a.original_height,top_x:b.left/a.$foreground_image.width(),top_y:b.top/a.$foreground_image.height(),bot_x:(b.left+a.options.width)/a.$foreground_image.width(),bot_y:(b.top+a.options.height)/a.$foreground_image.height()})});this.$drag_helper.draggable({drag:function(b,c){a.resize_center={x:(a.options.width/2-c.position.left)/a.$foreground_image.width(),y:(a.options.height/2-c.position.top)/a.$foreground_image.height()};a.$foreground_image.css({left:c.position.left,top:c.position.top});a.options.drag(b,c)},containment:a.$resize_container});this.element.find("#cropping_slider").slider({max:a.options.zoom*1000,value:1000,min:a.minimum*1000,slide:function(e,f){if(f.value>1000&&a.initial_height*(f.value/1000)>=a.original_height){a.$resize_warning.show()}else{a.$resize_warning.hide()}var d={height:a.initial_height*(f.value/1000),width:a.initial_width*(f.value/1000)};a.$foreground_image.css(d);a.$background_image.css(d);var c={left:-(a.resize_center.x*d.width-a.options.width/2),top:-(a.resize_center.y*d.height-a.options.height/2)};if(!a.options.contain||a.options.contain&&a.minimum==a.options.width/a.initial_width){c.left=c.left>0?0:c.left;c.left=-c.left+a.options.width>d.width?-(d.width-a.options.width)/a.options.width*100+"%":c.left/a.options.width*100+"%"}if(!a.options.contain||a.options.contain&&a.minimum==a.options.height/a.initial_height){c.top=c.top>0?0:c.top;c.top=-c.top+a.options.height>d.height?-(d.height-a.options.height)/a.options.height*100+"%":c.top/a.options.height*100+"%"}a.$foreground_image.css(c);a.$drag_helper.css(c);var b={height:d.height*2-a.options.height,width:d.width*2-a.options.width,left:a.options.width-d.width,top:a.options.height-d.height};b.height=a.options.contain&&b.height<a.options.height?a.options.height:b.height;b.width=a.options.contain&&b.width<a.options.width?a.options.width:b.width;b.left=a.options.contain&&b.left>0?0:b.left;b.top=a.options.contain&&b.top>0?0:b.top;a.$resize_container.css(b);a.options.slide(e,f)}})},ratio:function(){return this.$foreground_image.height()/this.original_height},start:function(){return{x:Math.abs(parseInt(this.$foreground_image.css("left")))/this.$foreground_image.width(),y:Math.abs(parseInt(this.$foreground_image.css("top")))/this.$foreground_image.height()}},end:function(){var b=Math.abs(parseInt(this.$foreground_image.css("left")));var a=Math.abs(parseInt(this.$foreground_image.css("top")));return{x:(b+this.options.width)/this.$foreground_image.width(),y:(a+this.options.height)/this.$foreground_image.height()}}});